Java PS3 Media Server for Windows
=================================
by shagrath

Hi there... you will find on this page an experimental upnp media server I've written in Java
(so you can also use it on Linux), with precious help from MPlayer/MEncoder, FFMpeg,
AVISynth eventually, and currently using with my Playstation3.... I was quite fed up with TVersity
and others servers I've tried as none of them easily supports subtitles and 1080p transcode,
as well as any kind of files I want to play without worrying about ps3 compatibility.
I'm currently transcoding in real-time and no quality loss, 1080p mkv files.
The drawback is the high bitrate your network must support: with the default settings,
specific scenes with a lot of details (e.g.: zoom on a newspaper article) can have
bitrates near 100mb/s, so gigabit is maybe useful.
However, you can limit the bitrate (with maybe a loss of quality, of course)


Current features
================

- Ready to launch and play. No folder configuration and pre-parsing or this kind of annoying thing. 
- All your folders are directly browsed by the PS3. There’s an automatic refresh also.
- Real-time video transcoding via Avisynth/FFmpeg in MPEG2 + experimental seeking.
- DTS -> LPCM real time muxing. Lossless transcoding !
- OGG/FLAC/MPC Audio transcoding
- Thumbnail generation for Videos
- All formats PS3 natively supports: MP3/WMA, JPG/PNG/GIF/TIFF, and all kind of videos (AVI, MP4, TS, M2TS, MPEG) the ps3 is willing to play
- ZIP/RAR files as browsable folders
- Support for pictures based feeds, such as Flickr and Picasaweb
- Internet TV / Web Radio support with MPlayer/VLC


Requirements
============

A core 2 duo CPU (mine is a E6750, 2.66GHz) for smooth 1080p transcoding, but 720p seems to be transcodable with a good P4 :p


Installation
============

- Get a Java Runtime Environment: http://www.java.com. JRE version 6 is a minimum.
- Launch PMS.exe (PMS.sh on Linux).
- If the server is not detected by the PS3 (this can happens if you have several network interfaces),
check the traces firs, and try setting a correct IP address in the "General Configuration" Tab, and restart the application


Transcoding on Windows: HOWTO
=============================

2 possible methods:

A) Using the server "as is": Nothing else to install, it will use Mencoder for the transcoding part.

B) Using Avisynth/FFDshow. Paired with CoreAVC, it's quite efficient with multi cores.
1- If not already done, get and install a codec pack with ffdshow (VSfilter must be included for subtitles).
   My favorite is CCCP Codec Pack [http://www.cccp-project.net/download.php?type=cccp]
2- Get and install AVISynth 2.5.7 (I've met some framerate problems with 2.5.8 betas)
   [http://downloads.sourceforge.net/avisynth2/Avisynth_257.exe?modtime=1168199840&big_mirror=0]
3- Set up the FFDShow Audio Mixer to 5.1 (3/0/2 LFE)
4- Set "Autoload VS Filter" to true
5- Configure Haali Splitter (audio/subtitles language priorities)

Optional Codecs: CoreAVC is a good choice for H264 decoding, Quicktime Alternative and Real Alternative are also useful
(Apple 1080p trailers for example).


Transcoding on Linux: HOWTO
===========================

You just need to have mplayer, mencoder and ffmpeg binaries on your path (the more recent, the better).


Usage
=====

Navigation/Transcode
--------------------

By default, wmv, avi, mpeg files are streamable, except in case of srt/sub file present with the same file name.
All videos can be transcoded, as each streamable video appears once into its folder, and once into
a special folder "#Transcoded#" present in each sub folder,
with different options (audio/subtitles/other transcoding tools maybe) so you can choose what's working best on ps3.
For the audio part, only ogg, flac, mpc audio files and such can be transcoded: I suppose (?) all mp3s, wma and wav files
can be played 'as is' by the ps3

Custom cover art
----------------

Just drop an image in the same folder as your movie file (jpeg or png) called <mymovie>.cover.jpg (or .png). For example,
for a movie called 'tokyo.mkv', the cover file will be named 'tokyo.mkv.cover.png'


Transcoding engine prioritization by folder
-------------------------------------------

If you have some movies who plays well with the tsMuxer engine, and nonetheless want
mencoder as your default engine, you can add [tsmuxer] at the end of this folder.
The tsmuxer engine will be the first suggested, either as a replacement for your non ps3 compatible video,
or on the top of the list proposed in the #Transcoded# folder. 

Available engine names:

Mencoder = [mencoder]
AviSynth/Mencoder = [avsmencoder]
AviSynth/FFmpeg = [avsffmpeg]
tsMuxer= [tsmuxer]

It's also working the same way for virtual based folders, such as web folders names (see WEB.CONF)
See the following web streaming engines:

MPlayer audio streaming = [mplayerwebaudio]
VideoLan audio streaming = [vclaudio]
MEncoder video streaming = [mencoderwebvideo]
VideoLan video streaming = [vclvideo]
Mplayer stream dump = [mplayervideodump]


Linear PCM Muxing
=================

The version 0.98 introduces a preliminary feature: Linear PCM remuxing with tsMuxer
(only working on Windows right now, struggled a few minutes without luck with pipes
and tsMuxer on linux). LPCM muxing is disabled by default, but you can safely enable it.
If there are some troubles with channels order, you can try the following switch
in the "Decoding settings" configuration line:

 -af channels=6:6:0:0:1:1:2:4:3:5:4:2:5:3
 
this should be the right order, but in case of, you can also try this one: 
 
 -af channels=6:6:0:0:1:2:2:3:3:5:4:1:5:4
 
maybe this order is not correct as well. Feedback are welcome, of course :)


History:
========

v1.00:

- New Features

IDX/SUB support for AviSynth ONLY
Revamped some UI, especially transcoding settings

- Fixes
... General
VIDEO_TS folders are now case insensitive
Yet another flac parsing bug
... MEncoder related:
Added wmv binary codecs in Windows package for smooth WMV-HD transcoding  
Switch to ac3/dts libavcodec decoder, should suppress these annoying random audio clicks ?
Rare and random video glitchs due to another seeking bug


v0.99:

- New features:

DVD ISOs images / VIDEO_TS Folder transcoder
DVR-MS support (need feedback)
Better subtitles configuration
Small things: FAQ, Thumbnail seeking position, UI changes, New Options, etc.

- Fixes:

Network/Transcode optimization: Wifi/Homeplug streaming should be smoother
A/V out of sync correction
Unsupported data error on almost SD videos when maximum bitrate was fixed
tsMuxer broken on Linux
Videos with FLAC audio tracks are now muxable to LPCM, along with DTS
Videos paused due to seeking bug
Audio files parsing method changes (Hope this will solve issues with some flac files)
Faster transcode start
Better support for audio low sample rates (<= 22kHz) based files
Subtitle files: .sub support was broken


v0.98:

- New features:
Lossless 5.1 PCM transcoding with DTS movies (Disabled by default, check the previous paragraph first)
Customizable AviSynth script
Audio podcasts, just tested the one from Engadget
tsMuxer now working on Linux for basic muxing (don't forget to give it execution rights)
Web video streamdump engine (Useful for streams natively supported by ps3, such as mpeg on rtsp)
Maximum bitrate management
Small things: Runnable in console mode under Linux ("PMS.sh console"), Folder prioritization of a specific streaming/transcoding engine, Custom cover art, additional infos on thumbnails

- Fixes:
Potential network problem with Java/Vista + increase of packet ttl
Transcode will not start with potential error 80710091
Flac transcoder
Audio tags for all audio codecs
Faster start of audio transcoded files

- Changes:
Revamped inter process communication on Windows between Java/Mencoder/tsMuxer (much more elegant now).

v0.97:
- Added:   GUI Configuration (at last!) / Transcoding options, encoding presets, etc.
- Added:   Ability to choose the default transcoding engine (mencoder only, avisynth+mencoder, avisynth+ffmpeg, tsmuxer, or none)
- Added:   tsMuxer as a real time muxer (Kinda experimental)
- Added:   A good audio tag reader library (http://entagged.sourceforge.net/)
- Fixed:   Bugs in UPNP advertising.
- Fixed:   Mencoder font cache bug which prevents transcode to start
- Fixed:   DLNA errors due to character encoding
- Fixed:   New folders were not refreshed/rescanned automatically
- Fixed:   (maybe) Network streaming (no transcode) performance issue (need feedback on this)
v0.96:
- Added:   Interactive way of choosing your audio language, subtitles and transcoder mode (see #Transcoded# Folder)
- Added:   Interactive settings (see #Settings# Folder)
- Added:   Better subtitles looking
- Fixed:   Folders browsing optimization
- Fixed:   Several network errors fixes with 2.52 firmware
- Fixed:   A lot of small things
v0.95: MEncoder now included as it's used for the transcoding part (Avisynth or not), Fixes with the 2.50 firmware,
       Better transcoding performance (but greater bitrates !), Lighter configuration file
v0.94: Fixes: 2.50 Firmware problem, better pipes and sub processes management 
v0.93: Fixed bug in the server IP adress binding
v0.92: Linux compatible version / Many bugs fixes / No more A/V temp files created (full use of pipes)
v0.91: Better memory handling / automatic detection of VLC and AviSynth
v0.90: First release, some bugs, experimental stuff done for myself (at first!)


Known issues:
=============

- No cover art is displayed for audio files.
- Seek to specific time is OK, but fast forward/fast rewind is not very reactive, especially with Avisynth transcoding (depends of the machine)
- Embedded fonts are buggy / not yet fully implemented in MEncoder (it's disabled by default with the -nofontconfig switch). Try Avisynth/Vobsub if the font design does matter :)


Thanks
======

- boblinds and snoots for the network test cases :)
- sarraken, bleuecinephile, bd.azerty, fabounnet for the support and feedbacks


Contact
=======

shagrath : ps3mediaserver@gmail.com

http://ps3mediaserver.blogspot.com/